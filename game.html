<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock Paper Scissors Battle Sim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Roboto', sans-serif;
            background-color: #050a14;
            color: white;
        }

        /* Northern Lights Background Animation */
        .aurora-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: radial-gradient(circle at bottom, #0b1a2b 0%, #000000 100%);
        }

        .aurora {
            position: absolute;
            filter: blur(60px);
            opacity: 0.6;
            animation: drift infinite alternate;
        }

        .aurora-1 {
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 40%, #00ff88 50%, transparent 60%);
            animation-duration: 15s;
        }

        .aurora-2 {
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(135deg, transparent 40%, #8800ff 50%, transparent 60%);
            animation-duration: 20s;
            animation-delay: -5s;
        }

        .aurora-3 {
            bottom: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(0deg, rgba(0, 255, 136, 0.2), transparent);
            filter: blur(40px);
            animation: pulse 8s infinite alternate;
        }

        @keyframes drift {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(20px, 40px) rotate(5deg); }
        }

        @keyframes pulse {
            0% { opacity: 0.3; height: 40%; }
            100% { opacity: 0.7; height: 60%; }
        }

        /* UI Overlay */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            pointer-events: auto;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .control-group {
            margin-bottom: 12px;
        }

        input[type=range] {
            width: 100%;
            accent-color: #00ff88;
        }

        .score-card {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin: 0 10px;
        }
        
        .winner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .winner-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .epic-text {
            font-family: 'Press Start 2P', cursive;
            font-size: 3rem;
            text-align: center;
            text-transform: uppercase;
            margin-bottom: 20px;
            animation: glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #e60073; }
            to { text-shadow: 0 0 20px #fff, 0 0 30px #ff4da6, 0 0 40px #ff4da6; }
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <!-- Northern Lights Background -->
    <div class="aurora-container">
        <div class="aurora aurora-1"></div>
        <div class="aurora aurora-2"></div>
        <div class="aurora aurora-3"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <!-- Top Scoreboard -->
        <div class="w-full flex justify-center">
            <div class="panel flex justify-center space-x-6">
                <div class="score-card text-gray-300">
                    <span class="mr-2 text-2xl">ü™®</span> <span id="rock-count">0</span>
                </div>
                <div class="score-card text-yellow-200">
                    <span class="mr-2 text-2xl">üìÑ</span> <span id="paper-count">0</span>
                </div>
                <div class="score-card text-red-400">
                    <span class="mr-2 text-2xl">‚úÇÔ∏è</span> <span id="scissors-count">0</span>
                </div>
            </div>
        </div>

        <!-- Bottom Controls -->
        <div class="w-full flex justify-center md:justify-end">
            <div class="panel w-full md:w-80 text-sm">
                <h3 class="font-bold text-center mb-3 text-emerald-400 uppercase tracking-widest">Battle Controls</h3>
                
                <div class="grid grid-cols-3 gap-2 mb-2 text-center text-xs text-gray-400">
                    <div>Rock</div><div>Paper</div><div>Scissors</div>
                </div>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <input type="number" id="input-rock" min="3" max="10" value="5" class="bg-gray-800 border border-gray-600 rounded p-1 text-center text-white">
                    <input type="number" id="input-paper" min="3" max="10" value="5" class="bg-gray-800 border border-gray-600 rounded p-1 text-center text-white">
                    <input type="number" id="input-scissors" min="3" max="10" value="5" class="bg-gray-800 border border-gray-600 rounded p-1 text-center text-white">
                </div>

                <div class="control-group">
                    <div class="flex justify-between mb-1">
                        <label>Speed Multiplier</label>
                        <span id="val-speed">1.0x</span>
                    </div>
                    <input type="range" id="input-speed" min="0.5" max="3" step="0.1" value="1">
                </div>

                <div class="control-group">
                    <div class="flex justify-between mb-1">
                        <label>Icon Size</label>
                        <span id="val-size">30px</span>
                    </div>
                    <input type="range" id="input-size" min="20" max="60" step="5" value="35">
                </div>

                <button id="btn-restart" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-4 rounded transition shadow-lg mt-2">
                    START BATTLE
                </button>
            </div>
        </div>
    </div>

    <!-- Epic Winner Overlay -->
    <div id="winner-overlay" class="winner-overlay">
        <div class="epic-text" id="winner-text">ROCK WINS!</div>
        <div class="text-xl mb-8 text-gray-300">Total Domination</div>
        <button id="btn-play-again" class="bg-white text-black font-bold py-3 px-8 rounded-full hover:scale-105 transition transform shadow-[0_0_20px_rgba(255,255,255,0.5)]">
            PLAY AGAIN
        </button>
    </div>

    <script>
        // --- Game Constants & State ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Types: 0: Rock, 1: Paper, 2: Scissors
        const TYPES = {
            ROCK: 0,
            PAPER: 1,
            SCISSORS: 2
        };

        const CONFIG = {
            icons: ['ü™®', 'üìÑ', '‚úÇÔ∏è'],
            colors: ['#a8a8a8', '#fefce8', '#f87171'], // Gray, Off-White, Red
            baseRadius: 20
        };

        let particles = [];
        let animationId;
        let isGameOver = false;
        
        // Runtime Settings
        let settings = {
            speedMult: 1,
            size: 35
        };

        // --- Class Definition ---
        class Particle {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                
                // Random velocity
                const angle = Math.random() * Math.PI * 2;
                const speed = (Math.random() * 2 + 1.5); // Base speed
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                
                this.radius = settings.size / 2;
                this.mass = 1; // Used for collision physics
            }

            draw() {
                // Update radius based on live settings
                this.radius = settings.size / 2;

                // Draw Circle Background
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = CONFIG.colors[this.type];
                ctx.shadowBlur = 10;
                ctx.shadowColor = CONFIG.colors[this.type];
                ctx.fill();
                ctx.shadowBlur = 0; // Reset shadow for icon
                ctx.closePath();

                // Draw Icon
                ctx.font = `${Math.floor(this.radius * 1.4)}px Arial`;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillStyle = "black";
                // Adjust Y slightly for emoji baseline quirks
                ctx.fillText(CONFIG.icons[this.type], this.x, this.y + (this.radius * 0.15));
            }

            update() {
                // Apply speed multiplier
                let dx = this.vx * settings.speedMult;
                let dy = this.vy * settings.speedMult;

                this.x += dx;
                this.y += dy;

                // Wall Collision
                // Right Wall
                if (this.x + this.radius > canvas.width) {
                    this.x = canvas.width - this.radius;
                    this.vx *= -1;
                }
                // Left Wall
                else if (this.x - this.radius < 0) {
                    this.x = this.radius;
                    this.vx *= -1;
                }
                // Bottom Wall
                if (this.y + this.radius > canvas.height) {
                    this.y = canvas.height - this.radius;
                    this.vy *= -1;
                }
                // Top Wall
                else if (this.y - this.radius < 0) {
                    this.y = this.radius;
                    this.vy *= -1;
                }
            }
        }

        // --- Logic Functions ---

        function initGame() {
            // Stop previous loop
            cancelAnimationFrame(animationId);
            isGameOver = false;
            document.getElementById('winner-overlay').classList.remove('active');

            // Resize canvas to window
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            particles = [];

            // Get counts from inputs
            let rCount = parseInt(document.getElementById('input-rock').value) || 5;
            let pCount = parseInt(document.getElementById('input-paper').value) || 5;
            let sCount = parseInt(document.getElementById('input-scissors').value) || 5;

            // Clamp constraints (Min 3, Max 10)
            rCount = Math.min(Math.max(rCount, 3), 10);
            pCount = Math.min(Math.max(pCount, 3), 10);
            sCount = Math.min(Math.max(sCount, 3), 10);

            // Spawn Particles
            spawnType(rCount, TYPES.ROCK);
            spawnType(pCount, TYPES.PAPER);
            spawnType(sCount, TYPES.SCISSORS);

            updateScoreboard();
            animate();
        }

        function spawnType(count, type) {
            for (let i = 0; i < count; i++) {
                let safe = false;
                let x, y;
                let attempts = 0;
                // Try to spawn without overlapping existing particles
                while (!safe && attempts < 100) {
                    x = Math.random() * (canvas.width - 100) + 50;
                    y = Math.random() * (canvas.height - 100) + 50;
                    safe = true;
                    
                    for (let other of particles) {
                        let d = Math.hypot(x - other.x, y - other.y);
                        if (d < settings.size * 2) {
                            safe = false;
                            break;
                        }
                    }
                    attempts++;
                }
                particles.push(new Particle(x, y, type));
            }
        }

        function resolveCollision(p1, p2) {
            const dx = p2.x - p1.x;
            const dy = p2.y - p1.y;
            const distance = Math.hypot(dx, dy);

            if (distance < p1.radius + p2.radius) {
                // 1. Resolve Overlap (prevent sticking)
                const overlap = (p1.radius + p2.radius - distance) / 2;
                const nx = dx / distance;
                const ny = dy / distance;

                p1.x -= nx * overlap;
                p1.y -= ny * overlap;
                p2.x += nx * overlap;
                p2.y += ny * overlap;

                // 2. Elastic Bounce Physics
                // Normal velocity components
                const v1n = (p1.vx * nx) + (p1.vy * ny);
                const v2n = (p2.vx * nx) + (p2.vy * ny);

                // Tangential velocity components (unchanged)
                const tx = -ny;
                const ty = nx;
                const v1t = (p1.vx * tx) + (p1.vy * ty);
                const v2t = (p2.vx * tx) + (p2.vy * ty);

                // Swap normal velocities for equal mass elastic collision
                // If masses were different, equations would be more complex
                const v1nFinal = v2n;
                const v2nFinal = v1n;

                // Convert scalar normal/tangential velocities back to vectors
                p1.vx = (v1nFinal * nx) + (v1t * tx);
                p1.vy = (v1nFinal * ny) + (v1t * ty);
                p2.vx = (v2nFinal * nx) + (v2t * tx);
                p2.vy = (v2nFinal * ny) + (v2t * ty);

                // 3. Battle Logic (Rock Paper Scissors)
                if (p1.type !== p2.type) {
                    battle(p1, p2);
                }
            }
        }

        function battle(p1, p2) {
            // Rules: 0 beats 2, 1 beats 0, 2 beats 1
            // (type + 1) % 3 === otherType -> type loses
            
            // Check if p1 wins
            if ((p1.type === TYPES.ROCK && p2.type === TYPES.SCISSORS) ||
                (p1.type === TYPES.PAPER && p2.type === TYPES.ROCK) ||
                (p1.type === TYPES.SCISSORS && p2.type === TYPES.PAPER)) {
                // P1 wins, P2 transforms
                p2.type = p1.type;
            } else {
                // P2 wins, P1 transforms
                p1.type = p2.type;
            }
        }

        function updateScoreboard() {
            const counts = [0, 0, 0];
            particles.forEach(p => counts[p.type]++);

            document.getElementById('rock-count').innerText = counts[0];
            document.getElementById('paper-count').innerText = counts[1];
            document.getElementById('scissors-count').innerText = counts[2];

            checkWinCondition(counts);
        }

        function checkWinCondition(counts) {
            // Check if only one type remains (and total > 0)
            const activeTypes = counts.filter(c => c > 0).length;
            
            if (activeTypes === 1 && particles.length > 0 && !isGameOver) {
                isGameOver = true;
                let winnerIndex = counts.findIndex(c => c > 0);
                let winnerName = "";
                let colorClass = "";
                
                if(winnerIndex === 0) { winnerName = "ROCK"; colorClass = "text-gray-300"; }
                if(winnerIndex === 1) { winnerName = "PAPER"; colorClass = "text-yellow-200"; }
                if(winnerIndex === 2) { winnerName = "SCISSORS"; colorClass = "text-red-400"; }

                const overlay = document.getElementById('winner-overlay');
                const text = document.getElementById('winner-text');
                
                text.innerText = `${winnerName} DOMINATION!`;
                text.className = `epic-text ${colorClass}`;
                
                setTimeout(() => {
                    overlay.classList.add('active');
                    cancelAnimationFrame(animationId);
                }, 1000); // Wait 1 second before showing screen so we see the last conversion
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update positions
            particles.forEach(p => {
                p.update();
                p.draw();
            });

            // Collision Detection
            // O(N^2) is fine for N <= 30
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    resolveCollision(particles[i], particles[j]);
                }
            }

            if (!isGameOver) {
                updateScoreboard();
                animationId = requestAnimationFrame(animate);
            }
        }

        // --- Event Listeners ---

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        document.getElementById('btn-restart').addEventListener('click', initGame);
        document.getElementById('btn-play-again').addEventListener('click', initGame);

        // Real-time Settings Updates
        document.getElementById('input-speed').addEventListener('input', (e) => {
            settings.speedMult = parseFloat(e.target.value);
            document.getElementById('val-speed').innerText = settings.speedMult.toFixed(1) + 'x';
        });

        document.getElementById('input-size').addEventListener('input', (e) => {
            settings.size = parseInt(e.target.value);
            document.getElementById('val-size').innerText = settings.size + 'px';
        });

        // Initialize on load
        window.onload = initGame;

    </script>
</body>
</html>